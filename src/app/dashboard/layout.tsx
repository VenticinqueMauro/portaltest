import Sidebar from "@/components/dashboard/layout/Sidebar";
import { NewsStatus, NewsType } from "@/types/news.types";
import { decodeToken } from "@/utils/utils";
import { Metadata } from "next";
import { Toaster } from 'sonner';
import { getProfile } from "./perfil/page";
import Image from "next/image";

export const metadata: Metadata = {
    title: 'Admin Panel | Noticias',
    description: 'Generated by create next app',
}

async function getPendingNews() {
    try {
        const response = await fetch(`${process.env.NEXT_PUBLIC_URL}api/news`);

        if (!response.ok) {
            throw new Error('Ocurri칩 un error al consultar las noticias');
        }

        const { data }: { data: NewsType[] } = await response.json();

        return data.some((news) => news.status === NewsStatus.PENDING);

    } catch (error) {
        console.error(error);
        return false;
    }
}


export default async function layout({ children }: { children: React.ReactNode }) {

    const token = decodeToken();

    const { data: user } = await getProfile(token.id)

    const hasPendingNews = await getPendingNews();

    return (
        <section className="min-h-screen bg-background text-foreground relative flex">
            <div className="xl:hidden flex justify-center items-center w-full text-xl text-center tracking-tight font-semibold relative bg-slate-50">
                <Image src='/fondo-login.png' width={1080} height={1080} alt="logo" className="w-[200px] rounded-full absolute top-1/2 -translate-x-1/2 -translate-y-1/2 left-1/2 z-0 opacity-20" />
                <p className="z-10">Esta funci칩n solo est치 disponible en dispositivos de mayor tama침o</p>
            </div>
            <div className="hidden xl:block">
                <Sidebar hasPendingNews={hasPendingNews} user={user} />
                <div className="flex-1 ml-[200px] overflow-y-auto pl-6">
                    {children}
                </div>
                <Toaster />
            </div>
        </section>
    )
}